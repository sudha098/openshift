# OpenShift Course â€“ Security Module

This module covers user and access management, RBAC, configuration objects, workload security, and OpenShiftâ€™s operator framework. It provides a solid foundation for securing applications and cluster resources.

## ðŸ“Œ Topics Covered

* User Management Overview (Users, ServiceAccounts, Groups)
* RBAC: Roles, RoleBindings, ClusterRoles, ClusterRoleBindings
* Demo: Setting Up User Contexts (Project-wise)
* ConfigMaps Overview
* Secrets Overview
* Network Policies â€“ Inter-Pod Security
* Security Context Constraints (SCC)
* Introduction to Operators

---

## ðŸ”¶ 1. User Management Overview

OpenShift provides multiple identity types for authentication and authorization.

### **Users**

* Represent individuals or external identities (LDAP, OAuth, GitHub, HTPasswd)
* Created by cluster admin or identity provider
* Used for logging into CLI/Web Console

Example (HTPasswd user):

```sh
oc create user john
```

### **ServiceAccounts**

* Accounts used by **pods** and **automated workloads**
* Provide scoped permissions for applications
* Each project has a default service account

Example:

```sh
oc create sa app-bot
```

### **Groups**

* Logical user collections
* Useful for assigning roles to multiple users at once

Example:

```sh
oc adm groups new dev-team john mary steve
```

---

## ðŸ”¶ 2. RBAC (Role-Based Access Control)

RBAC governs **what users/service accounts can do** within the cluster.

### **Roles**

* Define permissions (verbs + resources) **within a namespace**
* Example verbs: `get`, `list`, `create`, `delete`

Example Role:

```yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: view-pods
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]
```

### **RoleBinding**

* Binds a user/group/serviceaccount to a Role (namespace-scoped)

Example:

```sh
oc create rolebinding bind-john \
  --role=view-pods \
  --user=john
```

### **ClusterRoles**

* Like roles, but cluster-wide
* Can be used in any namespace
* Common examples: `cluster-admin`, `edit`, `view`

### **ClusterRoleBinding**

* Binds users or groups to a cluster-level Role

Example:

```sh
oc adm policy add-cluster-role-to-user cluster-admin john
```

---

## ðŸ”¶ 3. Demo â€“ Setting Up User Contexts Project-wise

Steps typically shown in a demo:

1. **Create multiple projects**

   ```sh
   oc new-project dev
   oc new-project test
   ```

2. **Assign role to a user per project**

   ```sh
   oc adm policy add-role-to-user edit john -n dev
   oc adm policy add-role-to-user view john -n test
   ```

3. **Test using user context**

   ```sh
   oc login -u john
   oc project dev
   oc get pods
   ```

4. **Verify access differences across namespaces**

---

## ðŸ”¶ 4. ConfigMap Overview

ConfigMaps store **non-sensitive configuration** such as:

* App properties
* Environment variables
* Config files

Example:

```sh
oc create configmap app-config --from-literal=MODE=production
```

Mount as environment vars:

```yaml
env:
- name: MODE
  valueFrom:
    configMapKeyRef:
      name: app-config
      key: MODE
```

---

## ðŸ”¶ 5. Secrets Overview

Secrets store **sensitive information**, encrypted at rest:

* Passwords
* TLS certificates
* Docker registry creds
* API tokens

Example:

```sh
oc create secret generic db-secret \
  --from-literal=DB_PASSWORD=myPass123
```

Mount into a pod:

```yaml
env:
- name: DB_PASSWORD
  valueFrom:
    secretKeyRef:
      name: db-secret
      key: DB_PASSWORD
```

---

## ðŸ”¶ 6. Network Policies â€“ Inter-Pod Security

NetworkPolicies control which pods can communicate with each other.

### **Why NetworkPolicies?**

* Implement zero-trust networking
* Restrict pod-to-pod traffic
* Enforce micro-segmentation

Example (allow only specific pods):

```yaml
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: allow-app
spec:
  podSelector:
    matchLabels:
      app: backend
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend
```

---

## ðŸ”¶ 7. Security Context Constraints (SCC)

SCC is an OpenShift-specific security feature that controls how containers run.

### **Controls provided by SCC:**

* Running as root vs non-root
* SELinux context
* Using host namespaces
* Volume types allowed
* Privileged mode

Common SCCs:

* `restricted` (default, most secure)
* `anyuid` (allows running as root)
* `privileged` (full host accessâ€”avoid when possible)

Grant SCC to a service account:

```sh
oc adm policy add-scc-to-user anyuid -z app-bot
```

---

## ðŸ”¶ 8. Introduction to Operators

Operators extend OpenShiftâ€™s capabilities by automating application lifecycle tasks.

### **What Operators Do**

* Install complex applications
* Handle upgrades
* Manage scaling and backing resources
* Enforce application-specific logic

Examples:

* **Etcd Operator**
* **Prometheus Operator**
* **OpenShift GitOps Operator**
* **OpenShift Service Mesh Operator**

### **Key Concepts**

* **CRD (Custom Resource Definition):** Defines a new API type
* **CR (Custom Resource):** Instance of that new type
* **Operator Lifecycle Manager (OLM):** Manages installation and updates of operators

---

## âœ… Summary

| Topic             | Key Learning                                      |
| ----------------- | ------------------------------------------------- |
| User Management   | Users, Groups, ServiceAccounts                    |
| RBAC              | Role/ClusterRole + RoleBinding/ClusterRoleBinding |
| User Context Demo | Project-scoped permissions                        |
| ConfigMaps        | Non-sensitive configuration storage               |
| Secrets           | Sensitive data management                         |
| Network Policies  | Pod-level communication control                   |
| SCC               | Workload security and permissions                 |
| Operators         | Application automation framework                  |

---
