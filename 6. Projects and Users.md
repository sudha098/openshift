# üîê OpenShift ‚Äî Projects, Users, RBAC & Authentication Overview

This guide covers how access control works in OpenShift, including **projects, users, roles, service accounts, OAuth providers**, and the **AllowAll / DenyAll authenticators**.

---

## üß© What is a Project?

A **Project** is an OpenShift Kubernetes namespace with additional metadata such as:

* Resource quotas
* User access control (RBAC)
* Network isolation

Projects represent isolated application spaces ‚Äî ideal per team or per environment.

### Common Project Commands

```bash
oc get projects
oc new-project <project-name>
oc project <project-name>
oc delete project <project-name>
```

Example:

```bash
oc new-project sockshop-dev
oc project sockshop-dev
```

---

## üë• Users in OpenShift

Users represent identities that interact with the OpenShift cluster. OpenShift supports:

| Type             | Purpose                                                |
| ---------------- | ------------------------------------------------------ |
| Normal users     | Login via OAuth (GitHub, LDAP, Google, Keycloak, etc.) |
| Service Accounts | Robot accounts for workloads/pipelines                 |
| System Users     | Predefined cluster users used by OpenShift components  |

---

### üìå System Users

System users begin with `system:` and are **not real humans**.
Examples:

| User                                   | Purpose                                   |
| -------------------------------------- | ----------------------------------------- |
| `system:admin`                         | Superuser with full access to the cluster |
| `system:masters`                       | Group controlling cluster admin access    |
| `system:serviceaccount:<project>:<sa>` | Service accounts for workloads            |

---

## üîë RBAC and Roles

Access in OpenShift is controlled with **Role-Based Access Control (RBAC)**.

| Role          | Permissions                                |
| ------------- | ------------------------------------------ |
| view          | Read-only                                  |
| edit          | Modify workloads; cannot change RBAC       |
| admin         | Full control inside a project              |
| cluster-admin | Full cluster-wide access (‚ö† use carefully) |

### Assign User Permissions

```bash
oc adm policy add-role-to-user <role> <user> -n <project>
```

Examples:

```bash
oc adm policy add-role-to-user view qa-user -n sockshop-dev
oc adm policy add-role-to-user edit dev-user -n sockshop-dev
oc adm policy add-role-to-user admin team-lead -n sockshop-dev
```

### Remove Permissions

```bash
oc adm policy remove-role-from-user <role> <user> -n <project>
```

---

## ü§ñ Service Accounts (SAs)

Service accounts are non-human user identities for workloads, pipelines, and automation.

List service accounts:

```bash
oc get sa -n <project>
```

Assign permissions:

```bash
oc adm policy add-role-to-user edit system:serviceaccount:<project>:pipeline -n <project>
```

---

## üîê OAuth Identity Providers

OpenShift uses **OAuth for authentication**.
OAuth providers include:

* GitHub
* Google
* GitLab
* LDAP
* HTPasswd
* Keycloak / OIDC
* *Static authenticators* (AllowAll, DenyAll)

OAuth configuration lives in the `OAuth` API object.

---

### üö¶ AllowAll & DenyAll OAuth Provider

| Provider                           | Purpose                                                   |
| ---------------------------------- | --------------------------------------------------------- |
| `AllowAllPasswordIdentityProvider` | Accepts *any* username & password (not secure ‚Äî lab only) |
| `DenyAllPasswordIdentityProvider`  | Blocks *all* username/password authentication             |

#### AllowAll OAuth Example (lab/demo only ‚ùó)

```yaml
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: allow_all_provider
    mappingMethod: claim
    type: AllowAllPasswordIdentityProvider
```

#### DenyAll OAuth Example

```yaml
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: deny_all_provider
    mappingMethod: claim
    type: DenyAllPasswordIdentityProvider
```

‚ö† *Never use AllowAll in production.*

---

## üß™ Quick Lab Scenario

```bash
# 1. Create project
oc new-project sockshop-dev

# 2. Add users
oc adm policy add-role-to-user admin dev1 -n sockshop-dev
oc adm policy add-role-to-user edit qa1 -n sockshop-dev
oc adm policy add-role-to-user view intern1 -n sockshop-dev

# 3. Deploy application (Sock Shop example)
oc apply -f complete-demo.yaml -n sockshop-dev

# 4. Check workloads
oc get pods,svc,route -n sockshop-dev
```

---

## üõ° Best Practices

| Area             | Recommendation                                                      |
| ---------------- | ------------------------------------------------------------------- |
| Project Strategy | One per environment and/or per team                                 |
| Access           | Use **view / edit / admin**, avoid `cluster-admin` for normal users |
| Automation       | Use service accounts, not human users                               |
| Security         | Enable OAuth + strong password/SSO, disable AllowAll                |
| Auditing         | Regularly check RBAC: `oc adm top projects` & `oc adm groups`       |

---

## üìö Useful Reference Commands

```bash
oc get users
oc get groups
oc get clusterrole
oc get clusterrolebinding
oc describe user <username>
oc describe project <project>
```

