## ğŸ³ Docker Build using Buildah on OpenShift

Buildah enables building **Dockerfile-based container images** securely on OpenShift **without requiring the Docker daemon or privileged containers**.

You keep the **same Dockerfile workflow**, but the image is built by **Buildah** under the hood.

---

### ğŸ§¾ Overview

| Step                         | Docker Build | Buildah Build |
| ---------------------------- | ------------ | ------------- |
| Engine                       | docker build | buildah build |
| Privileged required          | âš ï¸ Yes       | âŒ No          |
| Daemonless                   | âŒ            | âœ”ï¸            |
| Recommended for OpenShift 4+ | âŒ            | â­ Yes         |

So **Docker build using Buildah** = Dockerfile syntax with a more secure builder.

---

## ğŸ“Œ BuildConfig for Dockerfile Build using Buildah

```yaml
apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: demo-app
spec:
  source:
    git:
      uri: https://github.com/org/demo-app.git
    contextDir: .
  strategy:
    type: Build
    buildahStrategy:
      dockerfilePath: Dockerfile
  output:
    to:
      kind: ImageStreamTag
      name: demo-app:latest
```

ğŸŸ¢ **Even though you're using Dockerfile, OpenShift uses Buildah to build it securely.**

---

## ğŸ”„ Inline Dockerfile Example (build via Buildah)

```yaml
strategy:
  buildahStrategy: {}
source:
  type: Dockerfile
  dockerfile: |
    FROM golang:1.22-alpine AS builder
    WORKDIR /src
    COPY . .
    RUN go build -o app
    FROM alpine
    COPY --from=builder /src/app /usr/bin/app
    CMD ["app"]
```

Same syntax, same build logic â€” only the build engine changes.

---

## âš™ï¸ Start Build with CLI

Trigger the build:

```sh
oc start-build demo-app
```

Follow logs:

```sh
oc logs -f build/demo-app-1
```

---

## ğŸ“¦ Build Arguments (Docker ARG support)

```yaml
strategy:
  buildahStrategy:
    buildArgs:
      - name: VERSION
        value: "1.0"
```

Usage inside Dockerfile:

```dockerfile
ARG VERSION
LABEL app.version=$VERSION
```

---

## ğŸ” Private Base Image Pull / Registry Push

Attach secrets for registry auth:

```yaml
spec:
  output:
    pushSecret:
      name: registry-auth
  source:
    pullSecret:
      name: registry-auth
```

Buildah supports:

* DockerHub
* Quay
* ECR
* GCR
* ACR
* Artifactory

---

## â–¶ï¸ End-to-End CI/CD Flow (Dockerfile build using Buildah)

```
Git Commit
     â–¼
BuildConfig (Buildah Docker Build)
     â–¼
ImageStream (new tag)
     â–¼
Deployment (rollout triggered)
     â–¼
Route (Expose service externally)
```

---

## ğŸ§  When to choose â€œDocker Build using Buildahâ€

| Scenario                                      | Best Choice       |
| --------------------------------------------- | ----------------- |
| You want Dockerfile workflow                  | âœ”ï¸                |
| You care about container security             | âœ”ï¸                |
| Your cluster disallows privileged builds      | âœ”ï¸                |
| You want to migrate from Docker to OpenShift  | âœ”ï¸                |
| You need S2I automation instead of Dockerfile | âŒ S2I recommended |

---

## ğŸ Summary

| Feature              | Docker Build | Docker Build via Buildah |
| -------------------- | ------------ | ------------------------ |
| Uses Dockerfile      | âœ”ï¸           | âœ”ï¸                       |
| Privileged container | âŒ Required   | âŒ Not needed             |
| Daemon running       | Required     | Not required             |
| Enterprise security  | Medium       | â­ High                   |
| Recommended          | âŒ            | â­ Yes                    |

ğŸ”¥ **Buildah gives you Dockerfile builds with zero Docker and zero risk â€” the best CI/CD practice on OpenShift.**

